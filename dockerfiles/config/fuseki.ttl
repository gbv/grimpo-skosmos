@prefix :      <http://base/#> .
@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
@prefix tdb2:  <http://jena.apache.org/2016/tdb#> .
@prefix text:  <http://jena.apache.org/text#> .
@prefix skos:  <http://www.w3.org/2004/02/skos/core#> .
@prefix fuseki: <http://jena.apache.org/fuseki#> .

:service rdf:type fuseki:Service ;
    fuseki:name                       "skosmos" ;           # TODO: support to configure this

    fuseki:endpoint [                       # SPARQL query
        fuseki:operation fuseki:query ;
    ] ;
    fuseki:endpoint [                       # SPARQL query (alternative name)
        fuseki:operation fuseki:query ;
        fuseki:name "sparql"
    ] ;
    fuseki:endpoint  [                      # SPARQL update
        fuseki:operation fuseki:update
    ] ;
    fuseki:endpoint  [                      # SPARQL Graph Store Protocol (read)
        fuseki:operation fuseki:gsp-r 
    ] ;
    fuseki:endpoint  [                      # SPARQL Graph Store Protocol (read and write)
        fuseki:operation fuseki:gsp-rw
    ] ;
    fuseki:dataset                    :text_dataset
.

:text_dataset rdf:type text:TextDataset ;
    text:dataset    :tdb_dataset_readwrite ;
    text:index      [
        rdf:type text:TextIndexLucene ;
        text:directory      <file:/fuseki/databases/skosmos/text> ;
        text:entityMap      <#entMap> ;
        text:storeValues    true
    ]
.

:tdb_dataset_readwrite rdf:type tdb2:DatasetTDB2 ;
    tdb2:location             "/fuseki/databases/skosmos" ; # TODO: configure name
    tdb2:unionDefaultGraph    true ;
.


# Text index configuration for Skosmos
<#entMap> rdf:type text:EntityMap ;
    text:defaultField     "pref" ;
    text:entityField      "uri" ;
    text:uidField         "uid" ;
    text:langField        "lang" ;
    text:graphField       "graph" ;
    text:map (
         # skos:prefLabel
         [ text:field "pref" ;
           text:predicate skos:prefLabel ;
           text:analyzer [ rdf:type text:LowerCaseKeywordAnalyzer ]
         ]
         # skos:altLabel
         [ text:field "alt" ;
           text:predicate skos:altLabel ;
           text:analyzer [ rdf:type text:LowerCaseKeywordAnalyzer ]
         ]
         # skos:hiddenLabel
         [ text:field "hidden" ;
           text:predicate skos:hiddenLabel ;
           text:analyzer [ rdf:type text:LowerCaseKeywordAnalyzer ]
         ]
         # skos:notation
         [ text:field "notation" ;
           text:predicate skos:notation ;
           text:analyzer [ rdf:type text:LowerCaseKeywordAnalyzer ]
         ]
     )
.
